from pathlib import Path
import csv
fp = Path.cwd()/"csv_reports"/"MAB CSV"/"45-overheads.csv"
overhead_list = [] 
with fp.open(mode="r", encoding="UTF-8", newline="") as file:
    reader = csv.reader(file)
    next(reader)
    for expense, percentage in reader:
        empty_dict = dict()
        empty_dict["Category"] = expense
        empty_dict["Overheads"] = percentage
        overhead_list.append(empty_dict)


highest_category = overhead_list[0]["Category"]
highest_percentage = float(overhead_list[0]["Overheads"])
fp_cwd = Path.cwd()/"trial.txt"
fp_cwd.touch()
with fp_cwd.open(mode="w", encoding = "UTF-8", newline ="") as file:
    file.write(f"[HIGHEST OVERHEADS]{highest_category.upper()}: {highest_percentage}%\n")

from pathlib import Path
import csv
fp = Path.cwd()/"csv_reports"/"cash_on_hand.csv"

cash_on_hand_list = []
# reads the csv file containing cash on hand from day 40 to 50
with fp.open(mode="r", encoding="UTF-8", newline="") as file:
    reader = csv.reader(file)
    next(reader)
    for day, coh in reader:
        empty_dict = dict()
        empty_dict["Day"] = day
        empty_dict["Cash On Hand"] = coh
        cash_on_hand_list.append(empty_dict)
# keeps track of the previous day's cash on hand
previous_day = cash_on_hand_list[0]["Day"]
previous_coh = float(cash_on_hand_list[0]["Cash On Hand"])

fp_cwd = Path.cwd()/"trial.txt"
fp_cwd.touch()
# writes cash defecits if any onto txt file
with fp_cwd.open(mode="a", encoding = "UTF-8", newline ="") as file:
    for i in range(1, len(cash_on_hand_list)):
        current_day = cash_on_hand_list[i]["Day"]
        current_coh = float(cash_on_hand_list[i]["Cash On Hand"])
        if current_coh < previous_coh:
            difference = previous_coh - current_coh
            file.write(f"[CASH DEFICIT] DAY: {current_day} , AMOUNT: USD{difference}\n")
        previous_day = current_day
        previous_coh = current_coh   

from pathlib import Path
import csv
fp = Path.cwd()/"csv_reports"/"MAB CSV"/"profit-and-loss-usd.csv"

pnl_list = []
with fp.open(mode="r", encoding="UTF-8", newline="") as file:
    reader = csv.reader(file)
    next(reader)
    for day,sales,trading_profit, operating_expense, net_profit in reader:
        empty_dict = dict()
        empty_dict["Day"] = day
        empty_dict["Sales"] = sales
        empty_dict["Trading Profit"] = trading_profit
        empty_dict["Operating Expense"] = operating_expense
        empty_dict["Net Profit"] = net_profit
        pnl_list.append(empty_dict)

previous_day = pnl_list[0]["Day"]
previous_profit = float(pnl_list[0]["Net Profit"])

fp_cwd = Path.cwd()/"trial.txt"
fp_cwd.touch()
# writes cash defecits if any onto txt file
with fp_cwd.open(mode="a", encoding = "UTF-8", newline ="") as file:
    for i in range(1, len(pnl_list)):
        current_day = pnl_list[i]["Day"]
        current_profit = float(pnl_list[i]["Net Profit"])
        if current_profit < previous_profit:
            difference = previous_profit - current_profit
            file.write(f"[PROFIT DEFICIT] DAY: {current_day} , AMOUNT: USD{difference}\n")
        previous_day = current_day
        previous_profit = current_profit